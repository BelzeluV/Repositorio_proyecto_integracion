{% extends "base.html"%}
{% block title %}MusicPro | Regístrate!{% endblock %}
{% load crispy_forms_tags %}
{% load static %}
{% block content %}
<style>
    .imgcont {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
    }

    .imgcont img {
        object-fit: cover;
        width: 100%;
        height: 100%;
    }

    .tarjetacontenedor {
        background-color: rgba(0, 0, 0, 0.746);
        border-radius: 7px;
        border: 2px solid white;
        box-shadow: 0 0 25px rgb(175, 255, 1), inset 0 0 15px rgb(175, 255, 1);

    }

    .tarjetausuario {
        background-color: black;
        border-radius: 7px;
        border: 2px solid white;
        box-shadow: 0 0 25px rgba(255, 1, 1), inset 0 0 15px rgb(255, 1, 1);
    }

    .tarjetadatospersonales {
        background-color: black;
        border-radius: 10px;
        border: 2px solid white;
        box-shadow: 0 0 25px rgb(1, 119, 255), inset 0 0 15px rgb(1, 119, 255);
    }

    .tarjetafoto {
        background-color: black;
        border-radius: 7px;
        border: 2px solid white;
        box-shadow: 0 0 25px rgb(255, 1, 247), inset 0 0 15px rgb(255, 1, 247);
    }

    .contenedorerror {
        border-radius: 7px;
        border: 3px solid;
        box-shadow: 0 0 5px rgb(248, 53, 53), inset 0 0 5px rgb(248, 53, 53);
    }
</style>
<div class="container">
    <div class="row align-items-center d-flex justify-content-center my-5">
        <div class="col-lg-10 col-md-12 col-sm-12">
            <div class="card text-white tarjetacontenedor">
                <div class="card-header">
                    <h1 style="text-align: center;">
                        Regístrate en MusicPro!
                    </h1>
                </div>
                <div class="card-body">
                    <form action="" method="post" enctype="multipart/form-data">
                        <div class="row justify-content-center align-items-center">
                            <div class="col-xl-3 col-lg-6 col-md-7 my-2">
                                <div class="card tarjetausuario">
                                    <div class="d-grid gap-2">
                                        <a href="{% url 'inicio' %}" class="btn btn-danger">Volver al inicio</a>
                                    </div>
                                    <div class="card-header">
                                        <h4 style="text-align: center;">Sobre tu Usuario</h4>
                                    </div>
                                    <div class="card-body">
                                        {% csrf_token %}
                                        <label>Nombre de Usuario</label>
                                        {{form.username}}
                                        {% if form.username.errors %}
                                        <span class="text-danger">
                                            {% for error in form.username.errors %}
                                            {{ error }}
                                            {% endfor %}
                                        </span>
                                        {% endif %}

                                        <label>Contraseña</label>
                                        {{form.password1}}
                                        {% if form.password1.errors %}
                                        <span class="text-danger">
                                            {% for error in form.password1.errors %}
                                            {{ error }}
                                            {% endfor %}
                                        </span>
                                        {% endif %}

                                        <label>Repita la contraseña</label>
                                        {{form.password2}}
                                        {% if form.password2.errors %}
                                        <span class="text-danger">
                                            {% for error in form.password2.errors %}
                                            {{ error }}
                                            {% endfor %}
                                        </span>
                                        {% endif %}

                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-5 col-lg-8 col-md-8 my-2">
                                <div class="card tarjetadatospersonales">
                                    <div class="card-header">
                                        <h2 style="text-align: center;">Tus datos personales</h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-lg-5">
                                                <label>Nombres</label>
                                                {{form.first_name}}
                                                {% if form.first_name.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.first_name.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>
                                            <div class="col-lg-7">
                                                <label>Apellidos</label>
                                                {{form.last_name}}
                                                {% if form.last_name.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.last_name.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <label>Correo Electrónico</label>
                                                {{form.email}}
                                                {% if form.email.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.email.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>
                                            <div class="col-6">
                                                <label>Fecha de Nacimiento</label>
                                                {{form.nacimiento}}
                                                {% if form.nacimiento.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.nacimiento.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>
                                            {{form.genero | as_crispy_field}}
                                                {% if form.genero.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.genero.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col">
                                                <label>Rut</label>
                                                {{form.RUT}}
                                                {% if form.RUT.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.RUT.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>
                                            <div class="col">
                                                <label>teléfono</label>
                                                {{form.telefono}}
                                                {% if form.telefono.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.telefono.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                            </div>

                                        </div>
                                        <hr>
                                        <div class="row">

                                            <div class="col">
                                                <label>Dirección</label>
                                                {{form.Direccion}}
                                                {{ form.comuna | as_crispy_field }}
                                                {% if form.comuna.errors %}
                                                <span class="text-danger">
                                                    {% for error in form.comuna.errors %}
                                                    {{ error }}
                                                    {% endfor %}
                                                </span>
                                                {% endif %}
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-4 col-lg-8 col-md-6 my-2">
                                <div class="card tarjetafoto">
                                    <div class="card-header">
                                        <h3 style="text-align: center;">Un toque especial</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="row justify-content-center">
                                            <div class="col-8">
                                                <img src="https://i.pinimg.com/564x/24/50/ae/2450ae69306cfbffc1260f3d74d7163b.jpg"
                                                    id="image-preview" class="imgcont card-img-top"
                                                    style=" 
                                                    border-radius: 50%;
                                                        border: 2px solid white; 
                                                        box-shadow: 0 0 25px rgb(1, 119, 255), inset 0 0 15px rgb(1, 119, 255);">
                                            </div>
                                            <div class="col-sm-12">
                                                <label>Tu foto de Perfil</label>
                                                {{form.foto_de_Usuario}}
                                                {% if form.foto_de_Usuario.errors %}
                                                <div class="contenedorerror">

                                                    <span class="text-danger" style="text-align: center;">
                                                        {% for error in form.foto_de_Usuario.errors %}
                                                        {{ error }}
                                                        {% endfor %}
                                                    </span>
                                                </div>

                                                {% endif %}

                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <input type="submit" value="guardar" class="btn"
                                            style="background-color:rgb(255, 1, 247) ;color: white;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function previewImage(event) {
        var input = event.target;
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var imagePreview = document.getElementById('image-preview');
                imagePreview.style.display = 'block';
                imagePreview.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function checkRut(rut) {                    //v2 mejorada y re hecha
        var valor = rut.value.replace('.', '');
        valor = valor.replace('-', '');

        cuerpo = valor.slice(0, -1);
        dv = valor.slice(-1).toUpperCase();

        rut.value = cuerpo + '-' + dv

        if (cuerpo.length < 7) {
            rut.setCustomValidity("RUT Incompleto");
            return false;
        }

        suma = 0;
        multiplo = 2;

        for (i = 1; i <= cuerpo.length; i++) {
            index = multiplo * valor.charAt(cuerpo.length - i);
            suma = suma + index;
            if (multiplo < 7) { multiplo = multiplo + 1; } else { multiplo = 2; }

        }
        dvEsperado = 11 - (suma % 11);

        dv = (dv == 'K') ? 10 : dv;
        dv = (dv == 0) ? 11 : dv;

        if (dvEsperado != dv) {
            rut.setCustomValidity("RUT Inválido");
            return false;
        }
        rut.setCustomValidity('');
    }

</script>

{% endblock %}